/* global Vue */
document.addEventListener("DOMContentLoaded", function(event) { 
  var app = new Vue({
    el: '#usergames',
    data: { 
      games: [],
      user_id: '',
      message: "IT GOOD"
    },
    mounted: function() {
      $.get("http://localhost:3000/api/users/current", function(response) {

        // Query local API to get current user's Steam ID
        this.user_id = response['user']['steam_id'];
        var api_key = "<%= ENV['STEAM_KEY'] %>";

        // Build Steam API request from user's Steam ID and API key
        var url = "http://api.steampowered.com/IPlayerService/GetOwnedGames/v0001/?key=" + api_key + "&steamid=" + this.user_id + "&include_appinfo=1&format=json";

        // Get user's Steam games library and save it as a Vue model
        $.get(url, function(response) {
          var results = response['response'];
          steam_games = results['games'];
          for(var i=0; i < steam_games.length; i++) {
            game = steam_games[i];
            img_id = game['img_logo_url'];
            game['img_logo_url'] = "http://media.steampowered.com/steamcommunity/public/images/apps/" + game['appid'] +"/"+img_id+".jpg";
          }
          this.games = steam_games;
        }.bind(this));
      }.bind(this));
    },
    methods: {

    },
    computed: {

    }
  });
});